const Component = React.Component;


const tempRain = {
    "body": "circle-zebra-vertical",
    "eye": "frame13",
    "eyeBall": "ball15",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#0277BD",
    "bgColor": "#FFFFFF",
    "eye1Color": "#075685",
    "eye2Color": "#075685",
    "eye3Color": "#075685",
    "eyeBall1Color": "#0277BD",
    "eyeBall2Color": "#0277BD",
    "eyeBall3Color": "#0277BD",
    "gradientColor1": "#075685",
    "gradientColor2": "#0277BD",
    "gradientType": "linear",
    "gradientOnEyes": false,
    "logo": "",
    "logoMode": "default"
}
const tempNinja = {
    "body": "japnese",
    "eye": "frame12",
    "eyeBall": "ball14",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#0F8EAA",
    "bgColor": "#FFFFFF",
    "eye1Color": "#303236",
    "eye2Color": "#303236",
    "eye3Color": "#303236",
    "eyeBall1Color": "#303236",
    "eyeBall2Color": "#303236",
    "eyeBall3Color": "#303236",
    "gradientColor1": "#BD1D2B",
    "gradientColor2": "#96207E",
    "gradientType": "linear",
    "gradientOnEyes": false,
    "logo": "",
    "logoMode": "default"
}
const tempMosaic = {
    "body": "mosaic",
    "eye": "frame16",
    "eyeBall": "ball8",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [
       "fv"
    ],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#000000",
    "bgColor": "#FFFFFF",
    "eye1Color": "#000000",
    "eye2Color": "#000000",
    "eye3Color": "#000000",
    "eyeBall1Color": "#000000",
    "eyeBall2Color": "#000000",
    "eyeBall3Color": "#000000",
    "gradientColor1": "#A13535",
    "gradientColor2": "#0277bd",
    "gradientType": "linear",
    "gradientOnEyes": "true",
    "logo": "",
    "logoMode": "default"
}
const tempJungle = {
    "body": "rounded-pointed",
    "eye": "frame14",
    "eyeBall": "ball16",
    "erf1": [],
    "erf2": [
       "fh"
    ],
    "erf3": [
       "fv"
    ],
    "brf1": [],
    "brf2": [
       "fh"
    ],
    "brf3": [
       "fv"
    ],
    "bodyColor": "#5C8B29",
    "bgColor": "#FFFFFF",
    "eye1Color": "#3F6B2B",
    "eye2Color": "#3F6B2B",
    "eye3Color": "#3F6B2B",
    "eyeBall1Color": "#60A541",
    "eyeBall2Color": "#60A541",
    "eyeBall3Color": "#60A541",
    "gradientColor1": "#5C8B29",
    "gradientColor2": "#25492F",
    "gradientType": "radial",
    "gradientOnEyes": false,
    "logo": "",
    "logoMode": "default"
}
const tempEasy = {
    "body": "circular",
    "eye": "frame13",
    "eyeBall": "ball15",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#113151",
    "bgColor": "#FFFFFF",
    "eye1Color": "#000000",
    "eye2Color": "#000000",
    "eye3Color": "#000000",
    "eyeBall1Color": "#000000",
    "eyeBall2Color": "#000000",
    "eyeBall3Color": "#000000",
    "gradientColor1": null,
    "gradientColor2": null,
    "gradientType": "linear",
    "gradientOnEyes": true,
    "logo": "",
    "logoMode": "default"
}
const tempDot = {
    "body": "dot",
    "eye": "frame0",
    "eyeBall": "ball14",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#0277bd",
    "bgColor": "#FFFFFF",
    "eye1Color": "#0277bd",
    "eye2Color": "#0277bd",
    "eye3Color": "#0277bd",
    "eyeBall1Color": "#0277bd",
    "eyeBall2Color": "#0277bd",
    "eyeBall3Color": "#0277bd",
    "gradientColor1": null,
    "gradientColor2": null,
    "gradientType": "linear",
    "gradientOnEyes": true,
    "logo": "",
    "logoMode": "default"
}

const tempCoffee = {
    "body": "mosaic",
    "eye": "frame8",
    "eyeBall": "ball19",
    "erf1": [
       "fv"
    ],
    "erf2": [],
    "erf3": [],
    "bodyColor": "#0F8EAA",
    "bgColor": "#FAEDE7",
    "eye1Color": "#303236",
    "eye2Color": "#303236",
    "eye3Color": "#303236",
    "eyeBall1Color": "#303236",
    "eyeBall2Color": "#303236",
    "eyeBall3Color": "#303236",
    "gradientColor1": "#754D32",
    "gradientColor2": "#57503B",
    "gradientType": "linear",
    "gradientOnEyes": true,
    "logo": "",
    "logoMode": "default"
}
const tempBitcoin = {
    "body": "circle",
    "eye": "frame1",
    "eyeBall": "ball1",
    "erf1": [
       "fh"
    ],
    "erf2": [],
    "erf3": [
       "fh",
       "fv"
    ],
    "brf1": [
       "fh"
    ],
    "brf2": [],
    "brf3": [
       "fh",
       "fv"
    ],
    "bodyColor": "#4D4D4D",
    "bgColor": "#FFFFFF",
    "eye1Color": "#4D4D4D",
    "eye2Color": "#4D4D4D",
    "eye3Color": "#4D4D4D",
    "eyeBall1Color": "#F38E14",
    "eyeBall2Color": "#F38E14",
    "eyeBall3Color": "#F38E14",
    "gradientColor1": "",
    "gradientColor2": "",
    "gradientType": "linear",
    "gradientOnEyes": false,
    "logo": "#bitcoin",
    "logoMode": "default"
} 
const tempClassic = {
    "body": "square",
    "eye": "frame0",
    "eyeBall": "ball0",
    "erf1": [],
    "erf2": [],
    "erf3": [],
    "brf1": [],
    "brf2": [],
    "brf3": [],
    "bodyColor": "#000000",
    "bgColor": "#FFFFFF",
    "eye1Color": "#000000",
    "eye2Color": "#000000",
    "eye3Color": "#000000",
    "eyeBall1Color": "#000000",
    "eyeBall2Color": "#000000",
    "eyeBall3Color": "#000000",
    "gradientColor1": null,
    "gradientColor2": null,
    "gradientType": "linear",
    "gradientOnEyes": true,
    "logo": ""
};

const bitcoin = {
    "data": "bitcoin:1Q9A5jDbZ8M6xUM5bCDhzqrn1NAd5mzKs8?amount=0.00035129",
    "config": tempBitcoin,
    "size": 200,
    "download": "imageUrl",
    "file": "svg"
 }

class App extends Component {
    constructor(props) {
        super(props);
        this.state = {
            address: '',
            amount: '',
            imageUrl: '',
            isLoading: false,
            isDownload: true,
            imgIndex: 1,
            setingIcon: 1,
            templateEnd: 1,
            bitcoin: bitcoin
        }
        this.renderModal();
    }
    onCreate(e) {
        //TODO fetch api
        this.setState({isLoading: true});
        this.setState({isDownload: false});
        console.log('Posting request to QR BTC API...');
        //proxy bypass 'Access-Control-Allow-Origin' 
        var myUrl = 'https://qr-generator.qrcode.studio/qr/custom';
        var proxy = 'https://cors-anywhere.herokuapp.com/';
        var finalURL = proxy + myUrl;
        axios.post(finalURL, JSON.stringify(this.state.bitcoin))
        .then(res => {
            this.setState({
                imageUrl: 'https:'+res.data.imageUrl
            });
            this.setState({isLoading: false});
        })
    }
    onDownload(e) {
        this.setState({isDownload: true});
        //TODO covert svg to png
        var canvas = document.querySelector("canvas");
        var context = canvas.getContext("2d");
        // Create image by canvas
        var image = new Image;
        image.src = this.state.imageUrl;
        image.onload = function() {
            canvas.width = image.width;
            canvas.height = image.height;
            context.drawImage(image, 0, 0);
        } 
        // Disable btn download
        this.setState({isDownload: false});
    }
    onAddress(e) {
        //TODO update address
        //setState nhiều tầng
        const newState = Object.assign({}, this.state);
        newState.bitcoin.data = "bitcoin:"+e.target.value+bitcoin.data.substring(42, 55);
        this.setState(newState);
    }
    onAmount(e) {
        //TODO update amount
        //setState nhiều tầng
        const newState = Object.assign({}, this.state);
        newState.bitcoin.data = bitcoin.data.substring(0, 50)+e.target.value;
        this.setState(newState); //address & amount
    }
    onColorTop(e) {
        const newState = Object.assign({}, this.state);
        newState.bitcoin.config.gradientColor1 = e.target.value;
        this.setState(newState); //gradientColor1
    }
    onColorBottom(e) {
        const newState = Object.assign({}, this.state);
        newState.bitcoin.config.gradientColor2 = e.target.value;
        this.setState(newState); //gradientColor2
    }
    onColorBackground(e) {
        const newState = Object.assign({}, this.state);
        newState.bitcoin.config.bgColor  = e.target.value;
        this.setState(newState); //bgColor
    }
    onRange(e) {
        const newState = Object.assign({}, this.state);
        newState.bitcoin.size  = e.target.value;
        this.setState(newState); //size
    }
    onIndex(value,e) {
        this.setState({imgIndex: value});// order icon
        this.setState({setingIcon: 2}); // hiden icon
    }
    onChoiseTemplate(value,e) {
        // Set template json
        const newState = Object.assign({}, this.state);
        if(value == 1){
            newState.bitcoin.config = tempBitcoin;
        }else if(value == 2) {
            newState.bitcoin.config = tempClassic;
        }else if(value == 3) {
            newState.bitcoin.config = tempCoffee;
        }else if(value == 4) {
            newState.bitcoin.config = tempDot;
        }else if(value == 5) {
            newState.bitcoin.config = tempEasy;
        }else if(value == 6) {
            newState.bitcoin.config = tempJungle;
        }else if(value == 7) {
            newState.bitcoin.config = tempMosaic;
        }else if(value == 8) {
            newState.bitcoin.config = tempNinja;
        }else if(value == 9) {
            newState.bitcoin.config = tempRain;
        }
        this.setState(newState);
        this.setState({setingIcon: 1}); // show icon
        this.setState({templateEnd: value}); // save template end
    }
    onBeforeIndex(value, e) {
        this.setState({imgIndex: value}); // order icon
        this.setState({setingIcon: 1}); // show icon
    }
    renderModal() {
        let absUrl = window.location.href;
        const modal = new Modal();
        setTimeout(() => {
            document.getElementById('modal').innerHTML = modal.show(modal.btcAddress(), absUrl);
            const qrcode = new QRCode("qr-code-url", {
                width: 170,
                height: 170
            });
            qrcode.makeCode(absUrl);
        }, 1000);
    }
    render() {
        return (
            <div>
                {this.state.isLoading ? 
                    <div className="loader loader-double is-active"></div> : <div/>
                }
                <div className="m-2">
                    <table className="table table-bordered">
                        <thead>
                            <tr>
                                <th className="w400 text-center"> Bitcoin Wallet Valid</th>
                                <th className="w400 text-center" colSpan="2">Wallet Bitcoin is Blockchain</th>
                                <th className="w200 text-center">Templates</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td rowSpan="3">
                                <div className="text-center">
                                    <img src={this.state.imageUrl ? this.state.imageUrl : "/share/images/bitcoinqr.png"} width="160px" className="shadow"/><br/>
                                    <div className="m-3">
                                        <button onClick={this.onCreate.bind(this)} className="btn alert-success m-1">Create QR Code</button>
                                        <button onClick={this.onDownload.bind(this)} disabled={this.state.isDownload} className="btn alert-danger m-1">Download PNG</button>
                                    </div>
                                </div>
                            </td>
                            <td colSpan="2">
                                Address: 
                                <input type="text" onChange={this.onAddress.bind(this)} placeholder="1Q9A5jDbZ8M6xUM5bCDhzqrn1NAd5mzKs8" className="form-control border-green"/>
                                <br/>
                                <label>Amount:
                                    <input type="number" onChange={this.onAmount.bind(this)} placeholder="0.00035129" className="form-control border-green"/>
                                </label>
                            </td>
                            <td>
                                <div className="text-center">
                                    { this.state.setingIcon == 1 ? 
                                        <div>
                                            <img className={this.state.imgIndex == 1 ? 'show m-auto shadow':'hiden'} src={"/share/images/bitcoinqr.png"} width="130"/>
                                            <img className={this.state.imgIndex == 2 ? 'show m-auto shadow':'hiden'} src={"/share/images/classic.png"} width="130"/>
                                            <img className={this.state.imgIndex == 3 ? 'show m-auto shadow':'hiden'} src={"/share/images/coffee.png"} width="130"/>
                                            <img className={this.state.imgIndex == 4 ? 'show m-auto shadow':'hiden'} src={"/share/images/dot.png"} width="130"/>
                                            <img className={this.state.imgIndex == 5 ? 'show m-auto shadow':'hiden'} src={"/share/images/easy.png"} width="130"/>
                                            <img className={this.state.imgIndex == 6 ? 'show m-auto shadow':'hiden'} src={"/share/images/jungle.png"} width="130"/>
                                            <img className={this.state.imgIndex == 7 ? 'show m-auto shadow':'hiden'} src={"/share/images/mosaic.png"} width="130"/>
                                            <img className={this.state.imgIndex == 8 ? 'show m-auto shadow':'hiden'} src={"/share/images/ninja.png"} width="130"/>
                                            <img className={this.state.imgIndex == 9 ? 'show m-auto shadow':'hiden'} src={"/share/images/rain.png"} width="130"/>
                                        </div> : <img className="m-auto" src={"/share/images/3.gif"} width="130"/>
                                    }    
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colSpan="2">
                                <div className="row">
                                    <div className="col-1 mt-2">Size: </div>
                                    <div className="col-8">
                                        <input type="range" onChange={this.onRange.bind(this)} value={this.state.bitcoin.size} min="200" max="2000" className="form-control"/> 
                                    </div>
                                    <div className="col-3 mt-2 text-left"> {this.state.bitcoin.size} Pixel</div>
                                </div>
                            </td>
                            <td>
                                <div className="text-center"> 
                                    <button className="btn alert-primary" data-toggle="modal" data-target="#modal-open">Bitcoin Templates</button>
                                </div> 
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Gradient top: <input type="color" onChange={this.onColorTop.bind(this)} value={this.state.bitcoin.gradientColor1}/>
                            </td>
                            <td>
                                Gradient bottom: <input type="color" onChange={this.onColorBottom.bind(this)} value={this.state.bitcoin.gradientColor2}/>
                            </td>
                            <td>
                                Background: <input type="color" onChange={this.onColorBackground.bind(this)} value={this.state.bitcoin.bgColor}/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div className="text-center mt-3">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>

                <div className="modal fade" id="modal-open" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div className="modal-dialog modal-lg" role="document">
                        <div className="modal-content alert-dark-opacity-1">
                            <div className="modal-header">
                                <h5 className="modal-title" id="exampleModalLabel">Templates QR Code</h5>
                                <button type="button" className="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div className="modal-body">
                                <div>
                                    <img onClick={this.onIndex.bind(this,1)} className={this.state.imgIndex == 1 ? 'img-select m-1':'m-1'} src={"/share/images/bitcoinqr.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,2)} className={this.state.imgIndex == 2 ? 'img-select m-1':'m-1'} src={"/share/images/classic.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,3)} className={this.state.imgIndex == 3 ? 'img-select m-1':'m-1'} src={"/share/images/coffee.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,4)} className={this.state.imgIndex == 4 ? 'img-select m-1':'m-1'} src={"/share/images/dot.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,5)} className={this.state.imgIndex == 5 ? 'img-select m-1':'m-1'} src={"/share/images/easy.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,6)} className={this.state.imgIndex == 6 ? 'img-select m-1':'m-1'} src={"/share/images/jungle.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,7)} className={this.state.imgIndex == 7 ? 'img-select m-1':'m-1'} src={"/share/images/mosaic.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,8)} className={this.state.imgIndex == 8 ? 'img-select m-1':'m-1'} src={"/share/images/ninja.png"} width="130"/>
                                    <img onClick={this.onIndex.bind(this,9)} className={this.state.imgIndex == 9 ? 'img-select m-1':'m-1'} src={"/share/images/rain.png"} width="130"/>
                                </div>
                            </div>
                            <div className="modal-footer">
                                <button type="button" onClick={this.onChoiseTemplate.bind(this, this.state.imgIndex)} data-dismiss="modal" className="btn alert-primary">Save changes</button>
                                <button type="button" onClick={this.onBeforeIndex.bind(this, this.state.templateEnd)} className="btn alert-secondary" data-dismiss="modal">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal"></div>
            </div>
        )
    }
}

ReactDOM.render(
    <App />,
    document.getElementById('root')
);